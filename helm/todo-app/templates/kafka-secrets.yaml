{{- if and .Values.kafka.enabled .Values.kafka.auth.enabled }}
---
# Secret for Kafka Authentication (Redpanda Cloud / Confluent Cloud)
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-app.fullname" . }}-kafka-secrets
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "todo-app.labels" . | nindent 4 }}
type: Opaque
data:
  # Base64 encoded Kafka username
  username: {{ .Values.kafka.auth.username | b64enc | quote }}
  # Base64 encoded Kafka password
  password: {{ .Values.kafka.auth.password | b64enc | quote }}
  {{- if .Values.kafka.auth.saslMechanism }}
  # SASL mechanism (e.g., PLAIN, SCRAM-SHA-256, SCRAM-SHA-512)
  saslMechanism: {{ .Values.kafka.auth.saslMechanism | quote }}
  {{- end }}
{{- end }}
---
{{- if and .Values.kafka.enabled .Values.kafka.tls.enabled }}
---
# Secret for Kafka TLS Certificate (if using self-signed or custom CA)
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-app.fullname" . }}-kafka-tls
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "todo-app.labels" . | nindent 4 }}
type: Opaque
data:
  # CA certificate (base64 encoded)
  {{- if .Values.kafka.tls.caCert }}
  ca.crt: {{ .Values.kafka.tls.caCert | b64enc | quote }}
  {{- end }}
  # Client certificate (if mTLS is required)
  {{- if .Values.kafka.tls.clientCert }}
  tls.crt: {{ .Values.kafka.tls.clientCert | b64enc | quote }}
  {{- end }}
  # Client key (if mTLS is required)
  {{- if .Values.kafka.tls.clientKey }}
  tls.key: {{ .Values.kafka.tls.clientKey | b64enc | quote }}
  {{- end }}
{{- end }}
